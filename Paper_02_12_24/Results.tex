% Results
\section{Results}\label{Results}

%%%
\subsection{Data and Image Files}
\label{data_files}

The results in tables \ref{FP_P_0_05_Results}, \ref{Prec_0_667_Results}, and \ref{mProb_0_5_Results} are selections from the 
\verb|FP_P_0_05.csv|, 
\verb|Prec_0_667.csv|, and
\verb|mProb_0_5.csv| files in the 
\verb|./Keras/Analyze_Proba| folder at
\url{www.github.com/bburkman/Ambulance_Dispatch}

Each row of each of those three files represents a different combination of algorithm, hyperparameters, features and transformation; for instance the 
\verb|LogReg_5_Fold_alpha_0_5_Easy_Test_Transformed_98| is the logistic regression algorithm with $\alpha = 0.5$ on the Easy features transformed with $0.01 \text{ quantile } \to 0$ and $0.99 \text{ quantile } \to 1.0$.  

Each row of \verb|FP_P_0_05.csv| gives, for that (algorithm, hyperparameter, feature, transformation) combination the value of $p$ where, on $[p, p+0.01)$, the value of $\text{FP}/\text{P}$ is closest to 0.05, along with other metrics at that $p$-interval.  Similarly, the other files give metrics at the $p$-interval where precision is closest to 0.667 and marginal probability is closest to 0.5.  

For more details on the results of each (algorithm, hyperparameters, features, transformation) combination for all hundred intervals of $[p, p+0.01)$, see, for example, 

\noindent\verb|LogReg_5_Fold_alpha_0_5_Easy_Test_Transformed_98_100.csv|.  Most of those data files also come in a \verb|.tex| version in the same directory.  

The area under the ROC curve for each of the 13 models on each of the three sets of data features is given in \verb|ROC_AUC.csv|.

The plots for the model output are in the \verb|./Keras/Images| folder.  For each model on each set of data features there are five images, for instance, 

\verb|BRFC_alpha_0_5_Easy_Pred|,

\verb|BRFC_alpha_0_5_Easy_Test_Pred_Wide|, and

\verb|BRFC_alpha_0_5_Easy_Pred_Zoom|,

\verb|BRFC_alpha_0_5_Easy_Test_Pred_Zoom_Wide|, and

\verb|BRFC_alpha_0_5_Easy_Test_ROC|, 

\noindent and each image comes in a \verb|.png| and \verb|.pgf| version.  The \verb|Wide| pictures are 4.5 inches wide, and the others 2.0 inches.  The first two images have a domain of $p \in [0,1]$, and the \verb|Zoom| images from the minimum to maximum values of $p$.  


%%%
\subsection{Easy, Medium, and Hard Features}
\label{results_EMH}

Figure \ref{EMH_BRFC} shows the raw model output and ROC curves for the Balanced Random Forest Classifier model trained on the Easy, Medium, and Hard feature sets.  All three have significant overlap of the negative (does not need an ambulance) and positive (needs an ambulance) classes, but comparing the Hard to the Easy, the negative class in the Hard is pushed to the left and the positive to the right, better separating the two classes and giving a space (up to about $p=0.8$) to choose a decision threshold $\theta$ that will send more needed than unneeded ambulances.  

The ROC (Receiver Operating Characteristic) curves illustrate how well the models separate the positive and negative classes, with area under the curve (AUC) of 0.5 being no better than random and 1.0 being perfect separation.  The ROC AUC also support the idea that the models built on the Hard features set are much more predictive than the Medium, which are better than the Easy.

The thirteen models built on the Easy feature set had AUC in $[0.552,0.665]$, Medium in $[0.640,0.729]$, 
and Hard in $[0.708,0.801]$.  If we take out the worst Hard model and the worst Medium model, the ranges do not overlap.  

\begin{figure}[h]

\noindent\begin{tabular}{@{\hspace{-6pt}}p{4.3in} @{\hspace{-6pt}}p{2.0in}}
	\vskip 0pt
	\hfil {\normalfont\normalsize Easy Features Model Output}
	
	\input{../Keras/Images/BRFC_alpha_0_5_Easy_Pred_Wide.pgf}	
&
	\vskip 0pt
	\hfil {\normalfont\normalsize ROC Curve}
	
	\input{../Keras/Images/BRFC_alpha_0_5_Easy_ROC.pgf}
\cr
\end{tabular}

\noindent\begin{tabular}{@{\hspace{-6pt}}p{4.3in} @{\hspace{-6pt}}p{2.0in}}
	\vskip 0pt
	\hfil {\normalfont\normalsize Medium Features Model Output}
	
	\input{../Keras/Images/BRFC_alpha_0_5_Medium_Pred_Wide.pgf}	
&
	\vskip 0pt
	\hfil {\normalfont\normalsize ROC Curve}
	
	\input{../Keras/Images/BRFC_alpha_0_5_Medium_ROC.pgf}
\cr
\end{tabular}

\noindent\begin{tabular}{@{\hspace{-6pt}}p{4.3in} @{\hspace{-6pt}}p{2.0in}}
	\vskip 0pt
	\hfil {\normalfont\normalsize Hard Features Model Output}
	
	\input{../Keras/Images/BRFC_alpha_0_5_Hard_Pred_Wide.pgf}	
&
	\vskip 0pt
	\hfil {\normalfont\normalsize ROC Curve}
	
	\input{../Keras/Images/BRFC_alpha_0_5_Hard_ROC.pgf}
\cr
\end{tabular}

\caption{\normalfont\normalsize Balanced Random Forest Classifier with $\alpha = 0.5$ Model Results for Different Sets of Data Features.  Figure accompanies \S\ref{results_EMH}}
\label{EMH_BRFC}
\end{figure}

\FloatBarrier


%%%
\subsection{Best Model for Each Budgetary Criterion and Feature Set}
\label{results_best_model}

Our first budgetary decision criterion was that the increase in number of ambulances sent to crash persons with automated notifications from cell phones should be not more than 5\%.  Table \ref{FP_P_0_05_Results} gives, for each feature set (Easy, Medium, Hard) the best models, with ``best'' meaning that the model recommends sending the most ambulances that are actually needed (TP) subject to the constraint that we choose our decision threshold $\theta$ to be the value of $p$ such that  $\text{FP}/\text{P}$ is closest to $0.05$ on the interval $[p, p+0.01)$,

In Table \ref{FP_P_0_05_Results} we have included the best three models for each set of data features, ``best'' in that those models immediately dispatch the most needed ambulances (TP) while keeping within the budgetary constraint $\text{FP}/\text{P} \approx 0.05$.  

We have not here included similar results, like the Balanced Random Forest model with different hyperparameters, because the differences between the results of very similar models is more about the numerics and randomness than predictive of what a similar model on a slightly different dataset with different random seeds would produce.  


\begin{table}[h]
\caption{\normalfont\normalsize Best models and transformations for $\text{FP}/\text{P} = 0.05$ for each algorithm.  Table accompanies \S\ref{results_best_model}}
\label{FP_P_0_05_Results}

{\normalfont\normalsize
\begin{tabular}{cccc rlrrrr r}
\toprule
	Algorithm & 
	Features & 
	$\alpha$ & 
	$\gamma$ & 
	\multicolumn{1}{c}{Trans} &
	\multicolumn{1}{c}{$p$} & 
	\multicolumn{1}{c}{Neg} & 
	\multicolumn{1}{c}{Pos} & 
	\multicolumn{1}{c}{$\text{FP} / \text{P}$} & 
	\multicolumn{1}{c}{TP} &
\cr
\noalign{\vskip 2pt}
\hline
\noalign{\vskip 2pt}
Bal RF & Easy & 0.50 &  & 98 & 0.93 & 997 & 564 & 0.052 & 4,270\cr
Bal Bag & Easy &  &  & 95 & 0.97 & 755 & 389 & 0.056 & 4,197\cr
Keras & Easy & 0.85 & 0.0 & None & 0.75 & 2,345 & 1,106 & 0.058 & 3,469\cr
\noalign{\vskip 2pt}
\hline
\noalign{\vskip 2pt}
Bal RF & Medium & 0.50 & 0 & 95 & 0.94 & 679 & 523 & 0.055 & 7,290\cr
Keras & Medium & 0.50 & 2.0 & 100 & 0.69 & 1,328 & 1,134 & 0.055 & 6,595\cr
AdaBoost & Medium & 0 & 0 & 100 & 0.74 & 1,114 & 992 & 0.053 & 5,699\cr
\noalign{\vskip 2pt}
\hline
\noalign{\vskip 2pt}
Bal RF & Hard & 0.50 & 0 & None & 0.86 & 938 & 1,508 & 0.047 & 12,447\cr
Keras & Hard & 0.50 & 2.0 & 100 & 0.58 & 1,264 & 1,556 & 0.054 & 11,287\cr
RUSBoost & Hard & 0 & 0 & 100 & 0.71 & 1,245 & 1,200 & 0.054 & 7,336\cr
\bottomrule
\end{tabular}

}
\end{table}

%\FloatBarrier

Our second budgetary decision criterion was that, of the ambulances immediately dispatched, at least 2/3 should be actually needed.  Table \ref{Prec_0_667_Results} gives, for each feature set (Easy, Medium, Hard) the best models, 
with ``best'' meaning that the model recommends sending the most ambulances that are actually needed (TP) subject to the constraint that we choose our decision threshold $\theta$ to be the value of $p$ such that $\text{Precision} = \text{TP}/(\text{FP} + \text{TP})$ is closest to $0.667$ on the interval $[p, p+0.01)$.

Note that in the Easy features in Table \ref{Prec_0_667_Results}, none of the models attain $\text{Precision} = \text{TP}/(\text{FP} + \text{TP})$ close to $2/3$.  A city wanting to build a recommendation system on the Easy features would need to be satisfied with $\text{Precision} \approx 0.5$, that only half of the ambulances immediately dispatched would be needed.  


\begin{table}
\caption{\normalfont\normalsize Best models and transformations for $\text{Precision} = \text{TP} / (\text{FP} + \text{TP}) = 2/3$ for each algorithm.  Table accompanies \S\ref{results_best_model}}
\label{Prec_0_667_Results}

{\normalfont\normalsize
\begin{tabular}{cccc rlrrrr r}
\toprule
	Algorithm & 
	Features & 
	$\alpha$ & 
	$\gamma$ & 
	\multicolumn{1}{c}{Trans} &
	\multicolumn{1}{c}{$p$} & 
	\multicolumn{1}{c}{Neg} & 
	\multicolumn{1}{c}{Pos} & 
	\multicolumn{1}{c}{Prec} & 
	\multicolumn{1}{c}{TP} &
\cr
\noalign{\vskip 2pt}
\hline
\noalign{\vskip 2pt}
Bal RF & Easy & 0.5 &  & 98 & 0.99 & 430 & 343 & 0.507 & 1,411\cr
Bal Bag & Easy &  &  & None & 0.99 & 220 & 191 & 0.49 & 835\cr
Keras & Easy & 0.5 & 2.0 & None & 0.51 & 102 & 43 & 0.497 & 79\cr
\noalign{\vskip 2pt}
\hline
\noalign{\vskip 2pt}
Bal RF & Medium & 0.5 &  & 98 & 0.99 & 347 & 557 & 0.65 & 1554\cr
Keras & Medium & 0.5 & 0.0 & None & 0.73 & 51 & 55 & 0.664 & 326\cr
Log Reg & Medium & 0.5 & 0.0 & 100 & 0.83 & 25 & 22 & 0.623 & 114\cr
\noalign{\vskip 2pt}
\hline
\noalign{\vskip 2pt}
Bal RF & Hard & 0.5 &  & None & 0.82 & 1,321 & 1,697 & 0.667 & 18,708\cr
Keras & Hard & 0.5 & 2.0 & 95 & 0.85 & 617 & 769 & 0.666 & 10,701\cr
Log Reg & Hard & 0.5 &  & None & 0.69 & 144 & 235 & 0.666 & 2,269\cr
\bottomrule
\end{tabular}

}
\end{table}

%\FloatBarrier

Our third budgetary decision criterion was that each ambulance immediately dispatched should have at least a 50\% chance of being needed.  Table \ref{mProb_0_5_Results} gives, for each feature set (Easy, Medium, Hard) the best models, 
with ``best'' meaning that the model recommends sending the most ambulances that are actually needed (TP) subject to the constraint that we choose our decision threshold $\theta$ to be the value of $p$ such that $m\text{Prob} = \text{Pos}/(\text{Neg} + \text{Pos})$ is closest to $0.50$ on the interval $[p, p+0.01)$.


\begin{table}[h]
\caption{\normalfont\normalsize Best models and transformations for $m\text{Prob}= \text{Pos}/(\text{Neg} + \text{Pos}) \approx 0.5$ for each algorithm.  Table accompanies \S\ref{results_best_model}}
\label{mProb_0_5_Results}

{\normalfont\normalsize
\begin{tabular}{cccc rlrrrr r}
\toprule
	Algorithm & 
	Features & 
	$\alpha$ & 
	$\gamma$ & 
	\multicolumn{1}{c}{Trans} &
	\multicolumn{1}{c}{$p$} & 
	\multicolumn{1}{c}{Neg} & 
	\multicolumn{1}{c}{Pos} & 
	\multicolumn{1}{c}{$m$Prob} & 
	\multicolumn{1}{c}{TP} &
\cr
\noalign{\vskip 2pt}
\hline
\noalign{\vskip 2pt}
Bal RF & Easy & 0.5 & 0 & None & 0.98 & 228 & 228 & 0.5 & 395\cr
AdaBoost & Easy & 0 & 0 & 100 & 0.93 & 244 & 167 & 0.406 & 169\cr
Log Reg & Easy & 0.5 & 0 & 100 & 0.87 & 81 & 62 & 0.434 & 147\cr
\noalign{\vskip 2pt}
\hline
\noalign{\vskip 2pt}
Bal RF & Medium & 0.5 & 0 & 95 & 0.93 & 1,211 & 1,191 & 0.496 & 7,813\cr
Keras & Medium & 0.5 & 1.0 & 90 & 0.97 & 444 & 457 & 0.507 & 6,521\cr
Easy Ens & Medium & 0 & 0 & 98 & 0.91 & 812 & 800 & 0.496 & 5,259\cr
\noalign{\vskip 2pt}
\hline
\noalign{\vskip 2pt}
Bal RF & Hard & 0.5 & 0 & None & 0.78 & 1,882 & 1,817 & 0.491 & 25,371\cr
Bal Bag & Hard & 0 & 0 & None & 0.85 & 97 & 86 & 0.47 & 17,160\cr
Keras & Hard & 0.5 & 2.0 & 95 & 0.78 & 1,104 & 1,099 & 0.499 & 16,869\cr
\bottomrule
\end{tabular}

}
\end{table}



\FloatBarrier


